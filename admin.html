<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetici Paneli | Profil Düzenleme</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        :root {
            font-family: 'Inter', sans-serif;
        }
        .text-accent {
            color: #ef4444; /* Tailwind red-500 */
        }
        .bg-accent {
            background-color: #ef4444;
        }
        textarea {
            resize: vertical;
        }
    </style>
</head>
<body class="bg-gray-100 antialiased min-h-screen flex flex-col">

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- SABİT FIREBASE YAPILANDIRMASI (EN SON GÜNCEL) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBF0bchfUsw4yo1q1wU-rowR8RZ24CDgJ0",
            authDomain: "mete-73d7c.firebaseapp.com",
            projectId: "mete-73d7c",
            storageBucket: "mete-73d7c.firebasestorage.app",
            messagingSenderId: "785562796791",
            appId: "1:785562796791:web:4ee9767daf4a13a981c9f2",
            measurementId: "G-191XRBGG83"
        };
        // -----------------------------------------------------------------

        // Uygulama ID'si ve Firestore Yolu (Public Veri)
        const appId = firebaseConfig.projectId; // mete-73d7c
        const PROFILE_DOC_ID = 'main_professional_profile';
        
        let app, db, auth, userId = null;
        let profileDocRef;

        // HTML elementleri
        const loginScreen = document.getElementById('login-screen');
        const adminContent = document.getElementById('admin-content');
        const loginForm = document.getElementById('login-form');
        const emailInput = document.getElementById('admin-email');
        const passwordInput = document.getElementById('admin-password');
        const loginError = document.getElementById('login-error');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const saveAdminDataButton = document.getElementById('save-admin-data-btn');
        const bioTextareaAdmin = document.getElementById('bio-textarea-admin');
        const fullJsonTextarea = document.getElementById('full-json-textarea');
        const jsonErrorDiv = document.getElementById('json-error');
        const statusMessage = document.getElementById('status-message');
        const adminTitle = document.getElementById('admin-title');
        
        // Başlangıç verisi (Firestore'da veri yoksa kullanılacak)
        const initialProfileData = {
            bioText: "Merhaba, ben [Adınız Soyadınız]. Yaratıcı çözümler üreten ve sonuç odaklı bir profesyonelim. On yılı aşkın süredir [Uzmanlık Alanı]'nda çalışıyorum. Temel amacım, teknolojiyi ve stratejik düşünceyi birleştirerek iş süreçlerini dönüştürmektir. Sizinle birlikte yeni projelerde çalışmayı dört gözle bekliyorum.",
            name: "[Adınız Soyadınız]",
            title: "Kıdemli Yazılım Mimarı | Dijital Stratejist",
            expertise: [
                { name: "Veri Analizi", icon: "bar-chart-2" },
                { name: "Proje Yönetimi", icon: "git-branch" },
                { name: "Kullanıcı Deneyimi (UX)", icon: "layers" }
            ],
            socials: {
                linkedin: "https://linkedin.com/in/profiliniz",
                github: "https://github.com/profiliniz",
                email: "mailto:eposta@adresiniz.com"
            },
            education: [
                {
                    degree: "Yüksek Lisans, Bilgisayar Mühendisliği",
                    institution: "İstanbul Teknik Üniversitesi (İTÜ)",
                    years: "2018 - 2020",
                    description: "Yapay zeka ve büyük veri analizi üzerine uzmanlaşma."
                }
            ],
            workExperience: [
                {
                    title: "Kıdemli Yazılım Mimarı",
                    company: "TechNova Çözümleri A.Ş.",
                    years: "2020 - Devam Ediyor",
                    description: "Büyük ölçekli kurumsal uygulamaların mikro servis mimarisi ile yeniden yapılandırılmasına liderlik ettim."
                }
            ]
        };

        // --- FIREBASE BAŞLATMA VE YÖNETİM ---

        function initFirebase() {
            try {
                // Firebase'i başlat ve servisleri al
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                // Firestore Hata ayıklama seviyesini Debug'a ayarla
                setLogLevel('debug'); 

                // Belge referansını oluştur
                profileDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'profiles', PROFILE_DOC_ID);

                // Auth durumu değiştiğinde tetiklenir
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // YÖNETİCİ GİRİŞİ YAPILDI
                        userId = user.uid;
                        showAdminPanel();
                        loadProfileData();
                    } else {
                        // OTURUM KAPALI
                        showLoginScreen();
                    }
                });

            } catch (error) {
                console.error("HATA: Firebase başlatılamadı:", error);
                loginError.textContent = "HATA: Firebase başlatılamadı. Konsolu kontrol edin.";
                showLoginScreen(); // Hata olsa bile giriş ekranını göster
            }
        }

        function showLoginScreen() {
            loginScreen.classList.remove('hidden');
            adminContent.classList.add('hidden');
            adminTitle.textContent = 'Yönetici Girişi Gerekli';
        }

        function showAdminPanel() {
            loginScreen.classList.add('hidden');
            adminContent.classList.remove('hidden');
            adminTitle.textContent = 'Profil İçeriği Düzenleme';
        }

        async function attemptLogin(e) {
            e.preventDefault();
            loginError.textContent = '';
            const email = emailInput.value;
            const password = passwordInput.value;

            loginButton.disabled = true;
            loginButton.textContent = 'Giriş Yapılıyor...';
            
            try {
                // Firebase ile oturum açmayı dene
                await signInWithEmailAndPassword(auth, email, password);
                // Başarılı olursa onAuthStateChanged tetiklenecek
                loginButton.textContent = 'Giriş Yapıldı!';
            } catch (error) {
                console.error("Giriş hatası:", error);
                let errorMessage = "Geçersiz e-posta veya parola. (Kurulum talimatlarına bakın)";
                loginError.textContent = "HATA: " + errorMessage;
                loginButton.textContent = 'Giriş Yap';
                loginButton.disabled = false;
            }
        }

        async function attemptLogout() {
            try {
                await signOut(auth);
                // onAuthStateChanged tetiklenecek ve giriş ekranına dönülecek
                statusMessage.textContent = "Başarıyla çıkış yaptınız.";
                statusMessage.classList.remove('hidden', 'bg-red-100', 'text-red-800');
                statusMessage.classList.add('bg-yellow-100', 'text-yellow-800');
            } catch (error) {
                console.error("Çıkış hatası:", error);
            }
        }

        async function loadProfileData() {
            statusMessage.classList.add('hidden');
            
            try {
                const docSnap = await getDoc(profileDocRef);
                let dataToEdit;
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    dataToEdit = { ...initialProfileData, ...data }; 
                } else {
                    // Veri yoksa başlangıç verisini yükle ve kaydet
                    console.log("Profil verisi bulunamadı. Başlangıç verisi oluşturuluyor...");
                    dataToEdit = initialProfileData;
                    await setDoc(profileDocRef, initialProfileData);
                }
                
                bioTextareaAdmin.value = dataToEdit.bioText || '';
                // Sadece yapısal veriyi JSON alanına koy
                const { bioText, ...restOfData } = dataToEdit;
                fullJsonTextarea.value = JSON.stringify(restOfData, null, 2);
                
            } catch (error) {
                console.error("Veri yüklenirken hata:", error);
                statusMessage.textContent = "HATA: Veri yüklenemedi. Lütfen konsolu kontrol edin.";
                statusMessage.classList.remove('hidden', 'bg-green-100', 'text-green-800');
                statusMessage.classList.add('bg-red-100', 'text-red-800');
            }
        }

        async function saveAdminData() {
            jsonErrorDiv.textContent = '';
            statusMessage.classList.add('hidden');
            
            if (!userId) {
                 jsonErrorDiv.textContent = "HATA: Oturumunuz sona ermiş. Lütfen tekrar giriş yapın.";
                 return;
            }

            const newBioText = bioTextareaAdmin.value;
            const fullJsonString = fullJsonTextarea.value;
            let parsedJson = {};

            try {
                // JSON format kontrolü
                parsedJson = JSON.parse(fullJsonString);
            } catch (error) {
                jsonErrorDiv.textContent = "HATA: Yapısal Veri (JSON) formatı geçersiz. Lütfen hatayı düzeltin.";
                return;
            }
            
            try {
                const dataToSave = {
                    bioText: newBioText,
                    ...parsedJson
                };

                // Firestore'a kaydet
                await setDoc(profileDocRef, dataToSave);

                statusMessage.textContent = "BAŞARILI: Profil verisi anında güncellendi!";
                statusMessage.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
                statusMessage.classList.add('bg-green-100', 'text-green-800');
                
                setTimeout(() => { statusMessage.classList.add('hidden'); }, 4000);

            } catch (error) {
                console.error("Veri kaydedilirken hata oluştu:", error);
                jsonErrorDiv.textContent = "Kaydetme sırasında Firebase hatası oluştu. Konsolu ve Kuralları kontrol edin.";
                statusMessage.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-yellow-100', 'text-yellow-800');
                statusMessage.classList.add('bg-red-100', 'text-red-800');
                statusMessage.textContent = "HATA: Kaydetme işlemi başarısız oldu.";
            }
        }
        
        // --- EVENT LISTENERS ---
        loginForm.addEventListener('submit', attemptLogin);
        logoutButton.addEventListener('click', attemptLogout);
        saveAdminDataButton.addEventListener('click', saveAdminData);

        // Uygulamayı başlat
        window.onload = initFirebase;
    </script>

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto p-4 flex justify-between items-center">
            <h1 id="admin-title" class="text-2xl font-bold text-gray-800">Yönetici Paneli</h1>
            <nav class="flex space-x-4">
                <a href="index.html" class="flex items-center space-x-1 text-gray-600 hover:text-accent transition duration-300">
                    <i data-lucide="eye" class="w-5 h-5"></i>
                    <span>Profili Görüntüle</span>
                </a>
                <button id="logout-button" class="flex items-center space-x-1 text-white bg-gray-600 px-3 py-1 rounded-full text-sm hover:bg-red-600 transition duration-300 hidden">
                    <i data-lucide="log-out" class="w-4 h-4"></i>
                    <span>Çıkış Yap</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Ana İçerik Konteyneri -->
    <main class="flex-grow container mx-auto p-4 sm:p-8 lg:p-12">
        
        <!-- YÖNETİCİ GİRİŞ EKRANI -->
        <div id="login-screen" class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-xl hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Giriş Yap</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="admin-email" class="block text-sm font-medium text-gray-700 mb-1">E-posta</label>
                    <input type="email" id="admin-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="yönetici@eposta.com">
                </div>
                <div>
                    <label for="admin-password" class="block text-sm font-medium text-gray-700 mb-1">Parola</label>
                    <input type="password" id="admin-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="••••••••">
                </div>
                <button type="submit" id="login-button" class="w-full bg-accent text-white font-semibold py-3 rounded-xl hover:bg-red-600 transition duration-300">
                    Giriş Yap
                </button>
                <p id="login-error" class="text-sm text-red-500 mt-2 text-center"></p>
                <p class="text-xs text-gray-500 text-center mt-4">Bu alan sadece **Firebase Authentication** ile kayıtlı yöneticiler içindir.</p>
            </form>
        </div>
        
        <!-- YÖNETİM İÇERİĞİ -->
        <div id="admin-content" class="space-y-8 hidden">
            
            <!-- Durum Mesajı -->
            <div id="status-message" class="p-4 rounded-lg font-medium text-sm text-center hidden" role="alert"></div>

            <!-- 1. Biyografi Metni Düzenleme -->
            <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2 border-b pb-2">
                    <i data-lucide="file-text" class="w-5 h-5 text-accent"></i>
                    <span>1. Hakkımda / Biyografi Metni</span>
                </h2>
                <textarea id="bio-textarea-admin" rows="6" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent"></textarea>
                <p class="text-xs text-gray-500 mt-1">Bu alana düz metin girin. HTML etiketleri kullanmayın.</p>
            </section>
            
            <!-- 2. Yapısal Veri (JSON) Düzenleme -->
            <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2 border-b pb-2">
                    <i data-lucide="code" class="w-5 h-5 text-accent"></i>
                    <span>2. Yapısal Veri (İsim, Kariyer, Eğitim, Sosyal)</span>
                </h2>
                <textarea id="full-json-textarea" rows="20" class="w-full p-3 font-mono text-sm border border-gray-300 rounded-lg focus:ring-accent focus:border-accent"></textarea>
                <p class="text-xs text-gray-500 mt-1">Tüm listeleri, isim ve başlığı bu JSON formatında düzenleyin. **JSON formatını bozmamaya dikkat edin.**</p>
                <p id="json-error" class="text-sm text-red-500 mt-2"></p>
            </section>
            
            <!-- Kaydet Butonu -->
            <button id="save-admin-data-btn" class="w-full bg-accent text-white font-extrabold py-4 rounded-xl text-lg shadow-lg hover:bg-red-600 transition duration-300 flex items-center justify-center space-x-2">
                <i data-lucide="save" class="w-6 h-6"></i>
                <span>TÜM PROFİLİ KAYDET VE YAYINLA</span>
            </button>
            
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="text-center py-6 mt-auto border-t border-gray-200">
        <p class="text-gray-500 text-sm">Yönetici Paneli - Proje ID: mete-73d7c</p>
    </footer>

    <script>
        lucide.createIcons();
    </script>
</body>
</html>
