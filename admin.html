<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetici Paneli | Profil Düzenleme</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        :root { font-family: 'Inter', sans-serif; }
        .text-accent { color: #ef4444; }
        .bg-accent { background-color: #ef4444; }
        textarea { resize: vertical; }
        .input-group { margin-bottom: 1rem; }
    </style>
</head>
<body class="bg-gray-100 antialiased min-h-screen flex flex-col">

<!-- HEADER -->
<header class="bg-white shadow-md">
    <div class="container mx-auto p-4 flex justify-between items-center">
        <h1 id="admin-header-title" class="text-2xl font-bold text-gray-800">Yönetici Paneli</h1>
        <nav class="flex space-x-4">
            <a href="index.html" class="flex items-center space-x-1 text-gray-600 hover:text-accent transition duration-300">
                <i data-lucide="eye" class="w-5 h-5"></i>
                <span>Profili Görüntüle</span>
            </a>
            <button id="logout-button" class="flex items-center space-x-1 text-white bg-gray-600 px-3 py-1 rounded-full text-sm hover:bg-red-600 transition duration-300 hidden">
                <i data-lucide="log-out" class="w-4 h-4"></i>
                <span>Çıkış Yap</span>
            </button>
        </nav>
    </div>
</header>

<!-- ANA İÇERİK -->
<main class="flex-grow container mx-auto p-4 sm:p-8 lg:p-12">

    <!-- GİRİŞ EKRANI -->
    <div id="login-screen" class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-xl hidden">
        <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Yönetici Girişi</h2>
        <form id="login-form" class="space-y-4">
            <div>
                <label for="admin-email" class="block text-sm font-medium text-gray-700 mb-1">E-posta</label>
                <input type="email" id="admin-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="yönetici@eposta.com">
            </div>
            <div>
                <label for="admin-password" class="block text-sm font-medium text-gray-700 mb-1">Parola</label>
                <input type="password" id="admin-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="••••••••">
            </div>
            <button type="submit" id="login-button" class="w-full bg-accent text-white font-semibold py-3 rounded-xl hover:bg-red-600 transition duration-300">
                Giriş Yap
            </button>
            <p id="login-error" class="text-sm text-red-500 mt-2 text-center"></p>
            <p class="text-xs text-gray-500 text-center mt-4">Sadece kayıtlı Firebase Auth kullanıcıları içindir.</p>
        </form>
    </div>

    <!-- YÖNETİM PANELİ -->
    <div id="admin-content" class="space-y-8 hidden">

        <!-- Durum Mesajı -->
        <div id="status-message" class="p-4 rounded-lg font-medium text-sm text-center hidden" role="alert"></div>

        <!-- 1. Temel Profil Bilgileri -->
        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2 border-b pb-2">
                <i data-lucide="user-circle" class="w-5 h-5 text-accent"></i>
                <span>1. Temel Profil Bilgileri</span>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="input-group">
                    <label for="admin-name" class="block text-sm font-medium text-gray-700 mb-1">Ad Soyad</label>
                    <input type="text" id="admin-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="Mete Öztürk">
                </div>
                <div class="input-group col-span-2">
                    <label for="admin-title-job" class="block text-sm font-medium text-gray-700 mb-1">Pozisyon / Unvan</label>
                    <input type="text" id="admin-title-job" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="Kıdemli Yazılım Mimarı">
                </div>
            </div>

            <!-- Resim ve Önizleme -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                <div class="input-group md:col-span-2">
                    <label for="admin-profile-image-url" class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                        <i data-lucide="image" class="w-4 h-4 mr-1 text-gray-500"></i> Profil Resmi URL'si
                    </label>
                    <input type="url" id="admin-profile-image-url" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="https://ornek.com/profil.jpg">
                    <p class="text-xs text-gray-500 mt-1">Sadece harici resim URL'si yapıştırın.</p>
                </div>
                <div class="input-group flex flex-col items-center justify-start pt-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Canlı Önizleme</label>
                    <img id="admin-image-preview" src="https://placehold.co/150x150/cccccc/333333?text=Profil" alt="Profil Önizleme" class="w-24 h-24 object-cover rounded-full shadow-lg border-4 border-gray-200">
                </div>
            </div>

            <div class="input-group mt-4">
                <label for="admin-bio" class="block text-sm font-medium text-gray-700 mb-1">Biyografi Metni</label>
                <textarea id="admin-bio" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent"></textarea>
            </div>
        </section>

        <!-- 2. Sosyal Medya -->
        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2 border-b pb-2">
                <i data-lucide="link" class="w-5 h-5 text-accent"></i>
                <span>2. Sosyal Medya ve İletişim</span>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="input-group">
                    <label for="admin-linkedin" class="block text-sm font-medium text-gray-700 mb-1">LinkedIn URL</label>
                    <input type="url" id="admin-linkedin" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="https://linkedin.com/in/...">
                </div>
                <div class="input-group">
                    <label for="admin-github" class="block text-sm font-medium text-gray-700 mb-1">GitHub URL</label>
                    <input type="url" id="admin-github" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="https://github.com/...">
                </div>
                <div class="input-group">
                    <label for="admin-email-contact" class="block text-sm font-medium text-gray-700 mb-1">E-posta (mailto)</label>
                    <input type="text" id="admin-email-contact" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-accent focus:border-accent" placeholder="mailto:eposta@adresiniz.com">
                </div>
            </div>
        </section>

        <!-- 3. Uzmanlık -->
        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2 border-b pb-2">
                <i data-lucide="feather" class="w-5 h-5 text-accent"></i>
                <span>3. Uzmanlık Alanları</span>
            </h2>
            <div id="expertise-items-container" class="space-y-2"></div>
            <button type="button" id="add-expertise-btn" class="w-full mt-4 p-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition duration-300 flex items-center justify-center space-x-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i>
                <span>Uzmanlık Alanı Ekle</span>
            </button>
        </section>

        <!-- 4. Eğitim -->
        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2 border-b pb-2">
                <i data-lucide="graduation-cap" class="w-5 h-5 text-accent"></i>
                <span>4. Eğitim Geçmişi</span>
            </h2>
            <div id="education-items-container" class="space-y-2"></div>
            <button type="button" id="add-education-btn" class="w-full mt-4 p-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition duration-300 flex items-center justify-center space-x-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i>
                <span>Eğitim Öğesi Ekle</span>
            </button>
        </section>

        <!-- 5. Deneyim -->
        <section class="bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center space-x-2 border-b pb-2">
                <i data-lucide="briefcase" class="w-5 h-5 text-accent"></i>
                <span>5. İş Deneyimi</span>
            </h2>
            <div id="experience-items-container" class="space-y-2"></div>
            <button type="button" id="add-experience-btn" class="w-full mt-4 p-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition duration-300 flex items-center justify-center space-x-2">
                <i data-lucide="plus-circle" class="w-5 h-5"></i>
                <span>Deneyim Öğesi Ekle</span>
            </button>
        </section>

        <!-- KAYDET BUTONU -->
        <button id="save-admin-data-btn" class="w-full bg-accent text-white font-extrabold py-4 rounded-xl text-lg shadow-lg hover:bg-red-600 transition duration-300 flex items-center justify-center space-x-2 mt-4">
            <i data-lucide="save" class="w-6 h-6"></i>
            <span>TÜM PROFİLİ KAYDET VE YAYINLA</span>
        </button>

    </div>
</main>

<!-- FOOTER -->
<footer class="text-center py-6 mt-auto border-t border-gray-200">
    <p class="text-gray-500 text-sm">Yönetici Paneli - Proje ID: <span class="font-semibold text-gray-600" id="footer-app-id"></span></p>
</footer>

<!-- FIREBASE SDK + JS -->
<script type="module">
  // Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  // ------------------- FIREBASE CONFIG -------------------
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_ID",
    appId: "YOUR_APP_ID",
    measurementId: "YOUR_MEASUREMENT_ID"
  };
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth();
  const db = getFirestore(app);

  // ------------------- DOM ELEMENTLER -------------------
  const loginScreen = document.getElementById("login-screen");
  const loginForm = document.getElementById("login-form");
  const loginError = document.getElementById("login-error");
  const adminContent = document.getElementById("admin-content");
  const logoutButton = document.getElementById("logout-button");
  const statusMessage = document.getElementById("status-message");

  const expertiseContainer = document.getElementById("expertise-items-container");
  const educationContainer = document.getElementById("education-items-container");
  const experienceContainer = document.getElementById("experience-items-container");

  const addExpertiseBtn = document.getElementById("add-expertise-btn");
  const addEducationBtn = document.getElementById("add-education-btn");
  const addExperienceBtn = document.getElementById("add-experience-btn");

  const profileImageInput = document.getElementById("admin-profile-image-url");
  const profileImagePreview = document.getElementById("admin-image-preview");

  // ------------------- DYNAMIC ITEM TEMPLATE & FUNCTIONS -------------------
  function removeParentItem(button) { button.parentElement.remove(); }

  function getExpertiseTemplate(data={name:""}) {
      return `<div class="dynamic-item flex items-center gap-2 p-2 mb-2 bg-white border rounded">
          <input type="text" class="flex-1 border-b focus:outline-none p-2" placeholder="Uzmanlık Adı" value="${data.name}" />
          <button type="button" onclick="removeParentItem(this)" class="text-red-500 hover:text-red-700">Sil</button>
      </div>`;
  }
  function addExpertiseItem(data={name:""}) { expertiseContainer.insertAdjacentHTML('beforeend', getExpertiseTemplate(data)); }
  function getExpertiseItems() { return Array.from(expertiseContainer.querySelectorAll('.dynamic-item')).map(div=>({name: div.querySelector('input').value.trim()})).filter(i=>i.name.length>0); }

  function getEducationTemplate(data={degree:'', institution:'', years:'', description:''}) {
    return `<div class="dynamic-item flex flex-col p-2 mb-2 bg-white border rounded">
        <input type="text" placeholder="Derece" class="border-b focus:outline-none mb-1 p-2" value="${data.degree}" />
        <input type="text" placeholder="Kurum" class="border-b focus:outline-none mb-1 p-2" value="${data.institution}" />
        <input type="text" placeholder="Yıllar" class="border-b focus:outline-none mb-1 p-2" value="${data.years}" />
        <textarea placeholder="Açıklama" class="border-b focus:outline-none mb-1 p-2">${data.description}</textarea>
        <button type="button" onclick="removeParentItem(this)" class="text-red-500 hover:text-red-700 mt-1">Sil</button>
    </div>`;
  }
  function addEducationItem(data={degree:'', institution:'', years:'', description:''}) { educationContainer.insertAdjacentHTML('beforeend', getEducationTemplate(data)); }
  function getEducationItems() {
      return Array.from(educationContainer.querySelectorAll('.dynamic-item')).map(div=>{
          const inputs = div.querySelectorAll('input'); const textarea = div.querySelector('textarea');
          return { degree: inputs[0].value.trim(), institution: inputs[1].value.trim(), years: inputs[2].value.trim(), description: textarea.value.trim() };
      }).filter(i=>i.degree.length>0 || i.institution.length>0);
  }

  function getExperienceTemplate(data={title:'', company:'', years:'', description:''}) {
    return `<div class="dynamic-item flex flex-col p-2 mb-2 bg-white border rounded">
        <input type="text" placeholder="Pozisyon" class="border-b focus:outline-none mb-1 p-2" value="${data.title}" />
        <input type="text" placeholder="Şirket" class="border-b focus:outline-none mb-1 p-2" value="${data.company}" />
        <input type="text" placeholder="Yıllar" class="border-b focus:outline-none mb-1 p-2" value="${data.years}" />
        <textarea placeholder="Açıklama" class="border-b focus:outline-none mb-1 p-2">${data.description}</textarea>
        <button type="button" onclick="removeParentItem(this)" class="text-red-500 hover:text-red-700 mt-1">Sil</button>
    </div>`;
  }
  function addExperienceItem(data={title:'', company:'', years:'', description:''}) { experienceContainer.insertAdjacentHTML('beforeend', getExperienceTemplate(data)); }
  function getExperienceItems() {
      return Array.from(experienceContainer.querySelectorAll('.dynamic-item')).map(div=>{
          const inputs = div.querySelectorAll('input'); const textarea = div.querySelector('textarea');
          return { title: inputs[0].value.trim(), company: inputs[1].value.trim(), years: inputs[2].value.trim(), description: textarea.value.trim() };
      }).filter(i=>i.title.length>0 || i.company.length>0);
  }

  // ------------------- PROFİL ÖNİZLEME -------------------
  profileImageInput.addEventListener("input", ()=>{ profileImagePreview.src = profileImageInput.value || "https://placehold.co/150x150/cccccc/333333?text=Profil"; });

  // ------------------- EKLE BUTONLARI -------------------
  addExpertiseBtn.addEventListener("click", ()=>addExpertiseItem());
  addEducationBtn.addEventListener("click", ()=>addEducationItem());
  addExperienceBtn.addEventListener("click", ()=>addExperienceItem());

  // ------------------- GİRİŞ FORM -------------------
  loginForm.addEventListener("submit", async (e)=>{
    e.preventDefault(); loginError.textContent = '';
    const email = document.getElementById("admin-email").value;
    const password = document.getElementById("admin-password").value;
    try { await signInWithEmailAndPassword(auth, email, password); } 
    catch(err){ loginError.textContent = err.message; }
  });

  // ------------------- ÇIKIŞ -------------------
  logoutButton.addEventListener("click", ()=>signOut(auth));

  // ------------------- AUTH DURUM KONTROL -------------------
  onAuthStateChanged(auth, async user=>{
      if(user){ 
          loginScreen.classList.add("hidden"); adminContent.classList.remove("hidden"); logoutButton.classList.remove("hidden"); 
          document.getElementById("footer-app-id").textContent = firebaseConfig.projectId;

          // Verileri Firestore’dan çek
          const docRef = doc(db, "adminProfile", "main");
          const docSnap = await getDoc(docRef);
          if(docSnap.exists()){
              const data = docSnap.data();
              document.getElementById("admin-name").value = data.name || '';
              document.getElementById("admin-title-job").value = data.title || '';
              document.getElementById("admin-bio").value = data.bio || '';
              profileImageInput.value = data.profileImage || ''; profileImagePreview.src = data.profileImage || "https://placehold.co/150x150/cccccc/333333?text=Profil";
              document.getElementById("admin-linkedin").value = data.linkedin || '';
              document.getElementById("admin-github").value = data.github || '';
              document.getElementById("admin-email-contact").value = data.email || '';

              // Dinamik listeleri yükle
              expertiseContainer.innerHTML = ''; (data.expertise||[]).forEach(i=>addExpertiseItem(i));
              educationContainer.innerHTML = ''; (data.education||[]).forEach(i=>addEducationItem(i));
              experienceContainer.innerHTML = ''; (data.experience||[]).forEach(i=>addExperienceItem(i));
          }
      } else { loginScreen.classList.remove("hidden"); adminContent.classList.add("hidden"); logoutButton.classList.add("hidden"); }
  });

  // ------------------- KAYDET BUTONU -------------------
  document.getElementById("save-admin-data-btn").addEventListener("click", async ()=>{
      const payload = {
          name: document.getElementById("admin-name").value,
          title: document.getElementById("admin-title-job").value,
          bio: document.getElementById("admin-bio").value,
          profileImage: profileImageInput.value,
          linkedin: document.getElementById("admin-linkedin").value,
          github: document.getElementById("admin-github").value,
          email: document.getElementById("admin-email-contact").value,
          expertise: getExpertiseItems(),
          education: getEducationItems(),
          experience: getExperienceItems(),
          updatedAt: new Date()
      };
      try{
          await setDoc(doc(db, "adminProfile", "main"), payload);
          statusMessage.textContent = "Profil başarıyla kaydedildi!";
          statusMessage.className = "p-4 rounded-lg font-medium text-sm text-white text-center bg-green-500"; statusMessage.classList.remove("hidden");
          setTimeout(()=>statusMessage.classList.add("hidden"), 3000);
      }catch(err){
          statusMessage.textContent = "Kaydetme sırasında hata: "+err.message;
          statusMessage.className = "p-4 rounded-lg font-medium text-sm text-center text-white bg-red-500"; statusMessage.classList.remove("hidden");
      }
  });

  // ------------------- LUCIDE ICONS -------------------
  window.addEventListener("DOMContentLoaded", ()=>{ if(window.lucide) lucide.replace(); });
</script>
</body>
</html>
